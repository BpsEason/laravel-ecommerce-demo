; www.conf
; 此文件用於覆蓋 PHP-FPM 預設的 www.conf 配置，主要用於效能調校和日誌設置。

[www]
; 用戶和群組，與 Dockerfile 中的 'laravel' 用戶對應
user = laravel
group = laravel

; 監聽地址，確保 Nginx 可以連接
listen = 9000
;listen = /var/run/php-fpm.sock ; 如果使用 socket 連接，則配置此項並在 Nginx 中對應

; 監聽器的權限，當使用 socket 時需要
;listen.owner = nobody
;listen.group = nobody
;listen.mode = 0660

; 進程管理方式：
; static: 固定數量的子進程
; dynamic: 動態生成子進程，根據需求增減
; ondemand: 按需生成子進程，只有在請求時才生成，最節省資源，但啟動延遲高
; 推薦使用 'dynamic' 或 'static'。對於高流量網站，'static' 可能更穩定。
; 在 Docker 環境中，'dynamic' 或 'ondemand' 通常是更好的選擇，可以根據容器的資源限制進行擴展。
pm = dynamic

; 'dynamic' 或 'ondemand' 模式下的設置：
; pm.max_children: 最多可以有多少個子進程
; 建議根據容器記憶體和每個 PHP 進程的記憶體消耗估算。例如，如果每個進程消耗 50MB，容器有 1GB 記憶體，則 max_children 約為 (1024MB - 緩衝) / 50MB。
; 對於 2-4GB 記憶體的容器，100-200 可能是個合理的起點。
pm.max_children = 50

; pm.start_servers: 啟動時建立的子進程數量
pm.start_servers = 5

; pm.min_spare_servers: 閒置時最少保留的子進程數量
pm.min_spare_servers = 5

; pm.max_spare_servers: 閒置時最多保留的子進程數量
pm.max_spare_servers = 20

; pm.max_requests: 每個子進程處理的最大請求數，達到後會重啟，避免記憶體洩漏
pm.max_requests = 500

; 請求超時時間
; request_terminate_timeout: 單個請求的最大執行時間，防止長時間運行的腳本佔用資源
; 0 表示無限，不建議在生產環境使用
request_terminate_timeout = 300s

; 錯誤日誌
php_admin_value[error_log] = /proc/self/fd/2 ; 將錯誤輸出到標準錯誤，由 Docker Log Driver 處理
php_admin_flag[log_errors] = on

; 上傳檔案大小限制
php_admin_value[upload_max_filesize] = 64M
php_admin_value[post_max_size] = 64M

; 記憶體限制
php_admin_value[memory_limit] = 256M
